Alright, so I want to try to save some space in the compiled ROM size. While I'm not at the limit yet, the features I wish to add may be big, so now is a good time.

Take a look at makeSprites.js - this is a nodeJS script that takes the folder of SpriteBitmaps and generates sprites for TIGCC/extgraph.

Currently, it treats the sprites for the worms separately from other game sprites, and this is the system we'll be improving.

Worms sprite data can come in two varieties:

- worm_POSE_Mask, worm_POSE_Outline

or

- worm_POSE_Mask, worm_POSE_Light, worm_POSE_Dark

The node js code encodes all the sprites, and then populates an array called wormSprites with pointers to the sprites. The order is important <POSE> can change, but it's sorted by <POSE>, _Mask always comes first, then either _Outline, or _Mask followed by _Light, and_Dark versions.

It's obvious but the mask will be ANDED on to both buffers, and then either the _Outline will be ORed onto both light and dark buffers, or if it has specific versions, the _Light and _Dark will be ORed respectively.

To save on rom space, the flipped versions of these sprites are automatically generated in Main.c

The function void GenerateFlippedSprites() is called on start up. It fills a wormFlipBuffer with their reversed bits & stores the pointers in wormsSpritesFlipped[]. This way the drawing code has access to the flipped versions of the sprites.

To save more space, I think the masks can be programmatically generated as well.

Before we generate them automatically, we need to do some prep work.

First, I will delete some of the the worms masks from the Bitmaps\Worms folder for some of the poses. Currently, the worms sprite array will simply not have those sprites loaded. Instead, we need to change const unsigned short* wormsSprites to no longer be const.

Instead, the nodeJS script should first check all the file names and determine all the possible POSE names. It should check if any are missing a worm_POSE_Mask. If it is, it should still leave a spot in the array, but have it set to NULL.

When I run this script, and delete a Mask, I should see some NULLs in the arak for the masks I deleted. So the Node JS script needs to be smart enough to recognize a mask is missing and place a NULL in the array. Note that, it should assume the mask will be generated later, so it should still create the #define WORM_POSE_MASK <index> in the SpriteData.h file, as if it were there.

That will be a good first commit. Don't actually commit, but once this new logic is in place, we'll move over to Main.c and start implementing the mask generation process.